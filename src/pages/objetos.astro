<script>
  import { Application } from "@splinetool/runtime";
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);
  const canvas = document.getElementById("canvas3d") as HTMLCanvasElement;
  const spline = new Application(canvas, { renderMode: "auto" });
  spline
    .load("https://draft.spline.design/mGvH4awEDkuQ0CzW/scene.splinecode")
    .then(() => {
      const Robot = spline.findObjectByName("Robot");
      const Plataform = spline.findObjectByName("Plataform");
      let RobotPosition = -800;

      //Robot initalization
      if (Robot && Plataform) {
        gsap.set(Robot.position, {
          onComplete: () => {
            gsap.to(Robot.position, {
              x: RobotPosition,
              duration: 1,
              ease: "power2.inOut",
            });
          },
        });

        //Plataform initalization and animation
        gsap.to(Plataform.rotation, {
          y: Math.PI * 4,
          repeat: -1,
          duration: 10,
          ease: "none",
        });

        //ScrollTrigger
        ScrollTrigger.create({
          trigger: "#Part2Card",
          start: "top 80%",
          end: "bottom bottom",
        //   markers: true,
          scrub: true,
          onUpdate: (self) => {
            const progress =(Number(self.progress.toFixed(3))*1600)-800;
            gsap.to(Robot.position, {
              x: progress,
              duration: 0.1,
              ease: "power2.inOut",
            });
          },
        });
      }
    });
</script>

<main class="bg-black text-white overflow-y-auto">
  <div class="fixed top-0 left-0 w-screen h-screen pointer-events-none">
    <canvas id="canvas3d" class="w-full h-full"></canvas>
  </div>

  <div id="Part1Card" class="flex h-screen z-40">
    <div class="w-1/2 flex justify-center items-center"></div>
    <div class="w-1/2 flex flex-col justify-center items-center">
      <h3>Primera PARTE</h3>
      <div>cartita de ale</div>
    </div>
  </div>
  <div id="Part2Card" class="flex h-screen">
    <div class="w-1/2 flex flex-col justify-center items-center">
      <h3>SEGUNDA PARTE</h3>
      <div>cartita de ale</div>
    </div>
    <div class="w-1/2 flex justify-center items-center"></div>
  </div>
</main>
